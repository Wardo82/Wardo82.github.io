<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Multimedia Systems tests</title>

    <link rel="stylesheet" href="css/main.css" />

    <!-- include a-frame -->
    <script src="https://mnutsch.github.io/arjs_workshop/start/vendor/aframe/build/aframe.min.js"></script>

    <!-- include ar.js for aframe -->
    <script src='https://mnutsch.github.io/arjs_workshop/start/vendor/arjs/build/aframe-ar.js'></script>
    <script>ARjs.Context.baseURL = 'https://mnutsch.github.io/arjs_workshop/start/vendor/three.js/'</script>
    <!-- Note: the above libraries are included with absolute URL's, because Github.io seems to prefer those. Change them to relative URL's -->
    <script type="text/javascript">
      AFRAME.registerComponent('hello-world', {
          init: function () {
            console.log('Hello, World!');
            console.log(this);
          }
          });
    </script>
  </head>
  <body>


    <a-scene embedded arjs>
      <!-- Object declaration -->
      <a-assets>
        <a-asset-item id="arrow-obj" src="assets/arrow.dae"></a-asset-item>
      </a-assets>

      <!-- Markers -->
      <a-marker type="pattern" url="assets/pattern-circle.patt">
        <a-entity id="pattern-circle" position="0 1.5 0" scale="2 2 2" rotation="90 180 0" collada-model="#arrow-obj"></a-entity>
      </a-marker>

      <a-marker type="pattern" url="assets/pattern-square.patt">
        <a-entity id="pattern-square" position="0 1.5 0" scale="2 2 2" rotation="90 180 0" collada-model="#arrow-obj"></a-entity>
      </a-marker>

      <a-marker type="pattern" url="assets/pattern-triangle.patt">
        <a-entity id="pattern-triangle" position="0 1.5 0" scale="2 2 2" rotation="90 180 0" collada-model="#arrow-obj"></a-entity>
      </a-marker>

      <a-marker type="pattern" url="assets/pattern-x.patt">
        <a-entity hello-world id="pattern-x" position="0 1.5 0" scale="2 2 2" rotation="90 180 0" collada-model="#arrow-obj"></a-entity>
      </a-marker>

      <!-- add a simple camera -->
      <a-entity camera></a-entity>

    </a-scene>

    <!-- Main -->
    <div class="card">
      <p>The room you are looking for is: </p><p id="roomID"></p>
    </div>

    <script type="text/javascript" src="js/Vertex.js"></script>
    <script type="text/javascript" src="js/PriorityQueue.js"></script>
    <script type="text/javascript" src="js/Graph.js"></script>
    <script type="text/javascript">
      var id = undefined;

      var destinationCanvas = document.getElementById("destinationCanvas");

      window.onload = function(){

        id = localStorage.getItem('input_search');
        document.getElementById("roomID").innerHTML = id;
      }
      // -------------------------------------------------------
      // ---------------------- Main ---------------------------
      // -------------------------------------------------------
      var cross = new Vertex(1);
      cross.setQRCode("pattern-x.patt");
      var circle = new Vertex(2);
      circle.setQRCode("pattern-circle.patt");
      var triangle = new Vertex(3);
      triangle.setQRCode("pattern-triangle.patt");
      var square = new Vertex(4);
      square.setQRCode("pattern-square.patt");


      // Instance of graph
      var graph = new UndirectedGraph();
      // Node addition
      graph.addVertex(cross);
      graph.addVertex(circle);
      graph.addVertex(triangle);
      graph.addVertex(square);

      // Edges addition
      cross.setDistance(circle, 11);
      graph.addEdge(cross, circle, 315);

      cross.setDistance(circle, 3);
      graph.addEdge(circle, triangle, 90);

      cross.setDistance(square, 2);
      graph.addEdge(cross, square, 135);

      circle.setDistance(square, 4);
      graph.addEdge(square, triangle, 0);

      //console.log(graph.edges);

      // Chosing the proper destination
      var destination = undefined;
      switch (id) {
        case 'triangle':
          destination = triangle;
          break;
        case 'circle':
          destination = circle;
          break;
        case 'square':
          destination = square;
          break;
        default:
          destination = cross;
      }

      // Compute path from all vertices
      // TODO: Do it in a for loop. nodes.length is not working
      // var dijkstras = [0];
      // console.log(graph.getLength());
      // for (var i = 1; i < graph.nodes.length+1; i++) {
      //   var dijkstra = graph.Dijkstra(graph.nodes[i], destination);
      //   dijkstras[i] = dijkstra;
      // }
      var dijkstras = [];
      var dijkstraFromSquare = graph.Dijkstra(square, destination);
      var dijkstraFromCross = graph.Dijkstra(cross, destination);
      var dijkstraFromTriangle = graph.Dijkstra(triangle, destination);
      var dijkstraFromCircle = graph.Dijkstra(circle, destination);

      var squarePath = dijkstraFromSquare.path;
      console.log(squarePath);

      // Once we have the path we can point the arrow marker to the next marker
      // TODO: What you left was the pointing of the arrows.
      // For that you need a source, and you get that with a QRCode. Think of using the
      // QRCode to send you to the same web page but with ?source=id on the URL
      //document.getElementById()
      //grab the context from your destination canvas

      if (destination == cross) {
        var aux = document.getElementById("pattern-square");
        aux.setAttribute("rotation","90 135 0");
        var aux = document.getElementById("pattern-triangle");
        aux.setAttribute("rotation","90 270 0");
        var aux = document.getElementById("pattern-circle");
        aux.setAttribute("rotation","90 315 0");
        var aux = document.getElementById("pattern-x");
        aux.setAttribute("rotation","180 180 0");
      }



    </script>
  </body>
</html>
